<%-include('../partials/userheader')-%>
        <main class="main">

            <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3" style="background-color:#f2f3f7;">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html" style="font-weight: 500;">Home</a></li>
                        <li class="breadcrumb-item"><a href="#" style="font-weight: 500;">My Account</a></li>
                        <li class="breadcrumb-item active" aria-current="page" style="font-weight: 500;">My Cart</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->
            <div class="back-btn m-4">
                <a href="/"><i class="fas fa-arrow-left" style="color:black;font-size: large;"></i></a>
            </div>

            <div class="ur-acct">
                <h5>YOUR CART</h5>
            </div>
            <div class="page-content">
                <% if (cart && cart.product.length> 0) { %>
                    <div class="cart">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-9">
                                    <table id="myTable" class="table table-cart table-mobile">
                                        <thead>
                                            <tr>
                                                <th>Product</th>
                                                <th>Price</th>
                                                <th>Quantity</th>
                                                <th>Total</th>
                                                <th></th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <% for (var i=0; i < cart.product.length; i++) { %>
                                                <tr>
                                                    <td class="product-col">
                                                        <div class="product">
                                                            <figure class="product-media">
                                                                <a href="#">
                                                                    <img src="upload/<%= cart.product[i].product_id.image[0] %>"
                                                                        alt="Product image">
                                                                </a>
                                                            </figure>
                                                            <h3 class="product-title">
                                                                <a href="#">
                                                                    <%= cart.product[i].product_id.name %>
                                                                </a>
                                                            </h3>
                                                        </div>
                                                    </td>
                                                    <td class="price-col price">&#8377;<%=
                                                            cart.product[i].product_id.price %>
                                                    </td>
                                                    <td class="quantity-col">
                                                        <div class="cart-product-quantity">
                                                            <div class="row" style="border: 1px solid #222;width:84px">
                                                                <button class="minus value-button"
                                                                    style="border: 0; ">-</button>
                                                                <input type="text"
                                                                    data-id="<%= cart.product[i].product_id._id %>"
                                                                    class="qty"
                                                                    style="width: 40px; border: 0;text-align: center;"
                                                                    value="<%= cart.product[i].quantity %>">
                                                                <button class="plus value-button"
                                                                    style="border: 0;">+</button>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="total-col amount">
                                                        ₹<%= cart.product[i].product_id.price * cart.product[i].quantity
                                                            %>.00
                                                    </td>
                                                    <td class="remove-col">
                                                        <button data-cartid="<%= cart._id %>"
                                                            data-id="<%= cart.product[i].product_id._id %>"
                                                            class="removebtn btn-remove"><i
                                                                class="icon-close"></i></button>
                                                    </td>
                                                </tr>
                                                <% } %>
                                        </tbody>
                                    </table>
                                </div>
                                <aside class="col-lg-3">
                                    <div class="summary summary-cart">
                                        <h3 class="summary-title">Cart Total</h3>
                                        <!-- End .summary-title -->

                                        <table id="protable" class="table table-summary">
                                            <tbody>

                                                <tr class="summary-subtotal subtotal">
                                                    <td>Subtotal:</td>
                                                    <td class="total"></td>
                                                </tr><!-- End .summary-subtotal -->
                                                <tr class="summary-shipping">
                                                    <td>Shipping:</td>
                                                    <td>&nbsp;</td>
                                                </tr>

                                                <tr class="summary-shipping-row">
                                                    <td>
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="free-shipping" name="shipping"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label" for="free-shipping">Free
                                                                Shipping</label>
                                                        </div>
                                                        <!-- End .custom-control -->
                                                    </td>
                                                    <td>₹0.00</td>
                                                </tr>
                                                <!-- End .summary-shipping-row -->

                                                <tr class="summary-shipping-row">
                                                    <td>
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="standart-shipping" name="shipping"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label"
                                                                for="standart-shipping">Standart:</label>
                                                        </div>
                                                        <!-- End .custom-control -->
                                                    </td>
                                                    <td>₹0.00</td>
                                                </tr>
                                                <!-- End .summary-shipping-row -->

                                                <tr class="summary-shipping-row">
                                                    <td>
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="express-shipping" name="shipping"
                                                                class="custom-control-input">
                                                            <label class="custom-control-label"
                                                                for="express-shipping">Express:</label>
                                                        </div>
                                                        <!-- End .custom-control -->
                                                    </td>
                                                    <td>₹0.00</td>
                                                </tr>
                                                <!-- End .summary-shipping-row -->

                                                <tr class="summary-shipping-estimate">
                                                    <td>Estimate for Your
                                                        Country<br> <a href="#">Change
                                                            address</a></td>
                                                    <td>&nbsp;</td>
                                                </tr>
                                                <!-- End .summary-shipping-estimate -->

                                                <tr class="summary-total subtotal">
                                                    <td>Total:</td>
                                                    <td class="total"></td>
                                                </tr><!-- End .summary-total -->
                                            </tbody>
                                        </table><!-- End .table table-summary -->

                                        <a href="/checkout"
                                            class="btn btn-outline-primary-2 btn-order btn-block">PROCEED
                                            TO CHECKOUT</a>
                                    </div><!-- End .summary -->

                                    <a href="category.html" class="btn btn-outline-dark-2 btn-block mb-3"><span>CONTINUE
                                            SHOPPING</span><i class="icon-refresh"></i></a>
                                </aside><!-- End .col-lg-3 -->
                            </div>
                        </div>
                    </div>
                    <%} else { %>
                        <!-- Cart is empty -->
                        <div class="empty-cart m-5">
                            <p>Cart is empty</p>
                            <a href="/category" class="btn btn-outline-primary-2" style="width:50px;"><span>GO
                                    shopping</span><i class="icon-long-arrow-right"></i></a>
                        </div>
                        <% } %>
            </div><!-- End .page-content -->
    </div><!-- .End .tab-pane -->

    </div>
    </div>
    </div>
    </div>



    </div><!-- End .container -->
    </div><!-- End .dashboard -->
    </div><!-- End .page-content -->
    </main><!-- End .main -->
    <footer class="footer">
        <div class="footer-middle">
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="widget widget-about">
                            <img src="https://cavill.com.pt/img/cavill-logo-1611153476.jpg" class="footer-logo"
                                alt="Footer Logo" width="105" height="25">
                            <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate magna
                                eros eu erat. </p>

                            <div class="social-icons">
                                <a href="#" class="social-icon" target="_blank" title="Facebook"><i
                                        class="icon-facebook-f"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Twitter"><i
                                        class="icon-twitter"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Instagram"><i
                                        class="icon-instagram"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Youtube"><i
                                        class="icon-youtube"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Pinterest"><i
                                        class="icon-pinterest"></i></a>
                            </div><!-- End .soial-icons -->
                        </div><!-- End .widget about-widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="about.html">About Molla</a></li>
                                <li><a href="#">How to shop on Molla</a></li>
                                <li><a href="#">FAQ</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="login.html">Log in</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Payment Methods</a></li>
                                <li><a href="#">Money-back guarantee!</a></li>
                                <li><a href="#">Returns</a></li>
                                <li><a href="#">Shipping</a></li>
                                <li><a href="#">Terms and conditions</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">My Account</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Sign In</a></li>
                                <li><a href="cart.html">View Cart</a></li>
                                <li><a href="#">My Wishlist</a></li>
                                <li><a href="#">Track My Order</a></li>
                                <li><a href="#">Help</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .footer-middle -->

        <div class="footer-bottom">
            <div class="container">
                <p class="footer-copyright">Copyright © 2019 Molla Store. All Rights Reserved.</p>
                <!-- End .footer-copyright -->
                <figure class="footer-payments">
                    <img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
                </figure><!-- End .footer-payments -->
            </div><!-- End .container -->
        </div><!-- End .footer-bottom -->
    </footer><!-- End .footer -->
    </div><!-- End .page-wrapper -->
    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay"></div><!-- End .mobil-menu-overlay -->

    <div class="mobile-menu-container">
        <div class="mobile-menu-wrapper">
            <span class="mobile-menu-close"><i class="icon-close"></i></span>

            <form action="#" method="get" class="mobile-search">
                <label for="mobile-search" class="sr-only">Search</label>
                <input type="search" class="form-control" name="mobile-search" id="mobile-search"
                    placeholder="Search in..." required>
                <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
            </form>

            <nav class="mobile-nav">
                <ul class="mobile-menu">
                    <li class="active">
                        <a href="index.html">Home</a>


                    </li>
                    <li>
                        <a href="category.html">Shop</a>

                    </li>
                    <li>
                        <a href="#">Product</a>
                        <ul>
                            <li>
                                <a href="about.html">Boots</a>


                            </li>
                            <li>
                                <a href="contact.html">Slippers & Sandels</a>


                            </li>
                            <li><a href="login.html">Shoes</a></li>

                        </ul>
                    </li>
                    <li>
                        <a href="#">Pages</a>
                        <ul>
                            <li>
                                <a href="about.html">About</a>


                            </li>
                            <li>
                                <a href="contact.html">Contact</a>


                            </li>
                            <li><a href="login.html">Login</a></li>

                        </ul>
                    </li>
                    <li>
                        <a href="blog.html">Blog</a>


                    </li>


                </ul>
                </li>

            </nav><!-- End .mobile-nav -->

            <div class="social-icons">
                <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
            </div><!-- End .social-icons -->
        </div><!-- End .mobile-menu-wrapper -->
    </div><!-- End .mobile-menu-container -->

    <!-- Sign in / Register Modal -->
    <div class="modal fade" id="signin-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"><i class="icon-close"></i></span>
                    </button>

                    <div class="form-box">
                        <div class="form-tab">
                            <ul class="nav nav-pills nav-fill" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="signin-tab" data-toggle="tab" href="#signin"
                                        role="tab" aria-controls="signin" aria-selected="true">Sign In</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="register-tab" data-toggle="tab" href="#register" role="tab"
                                        aria-controls="register" aria-selected="false">Register</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="tab-content-5">
                                <div class="tab-pane fade show active" id="signin" role="tabpanel"
                                    aria-labelledby="signin-tab">
                                    <form action="#">
                                        <div class="form-group">
                                            <label for="singin-email">Username or email address *</label>
                                            <input type="text" class="form-control" id="singin-email"
                                                name="singin-email" required>
                                        </div><!-- End .form-group -->

                                        <div class="form-group">
                                            <label for="singin-password">Password *</label>
                                            <input type="password" class="form-control" id="singin-password"
                                                name="singin-password" required>
                                        </div><!-- End .form-group -->

                                        <div class="form-footer">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>LOG IN</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>

                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input"
                                                    id="signin-remember">
                                                <label class="custom-control-label" for="signin-remember">Remember
                                                    Me</label>
                                            </div><!-- End .custom-checkbox -->

                                            <a href="#" class="forgot-link">Forgot Your Password?</a>
                                        </div><!-- End .form-footer -->
                                    </form>
                                    <div class="form-choice">
                                        <p class="text-center">or sign in with</p>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-g">
                                                    <i class="icon-google"></i>
                                                    Login With Google
                                                </a>
                                            </div><!-- End .col-6 -->
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-f">
                                                    <i class="icon-facebook-f"></i>
                                                    Login With Facebook
                                                </a>
                                            </div><!-- End .col-6 -->
                                        </div><!-- End .row -->
                                    </div><!-- End .form-choice -->
                                </div><!-- .End .tab-pane -->
                                <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                                    <form action="#">
                                        <div class="form-group">
                                            <label for="register-email">Your email address *</label>
                                            <input type="email" class="form-control" id="register-email"
                                                name="register-email" required>
                                        </div><!-- End .form-group -->

                                        <div class="form-group">
                                            <label for="register-password">Password *</label>
                                            <input type="password" class="form-control" id="register-password"
                                                name="register-password" required>
                                        </div><!-- End .form-group -->

                                        <div class="form-footer">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>SIGN UP</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>

                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" id="register-policy"
                                                    required>
                                                <label class="custom-control-label" for="register-policy">I agree to the
                                                    <a href="#">privacy policy</a> *</label>
                                            </div><!-- End .custom-checkbox -->
                                        </div><!-- End .form-footer -->
                                    </form>
                                    <div class="form-choice">
                                        <p class="text-center">or sign in with</p>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-g">
                                                    <i class="icon-google"></i>
                                                    Login With Google
                                                </a>
                                            </div><!-- End .col-6 -->
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login  btn-f">
                                                    <i class="icon-facebook-f"></i>
                                                    Login With Facebook
                                                </a>
                                            </div><!-- End .col-6 -->
                                        </div><!-- End .row -->
                                    </div><!-- End .form-choice -->
                                </div><!-- .End .tab-pane -->
                            </div><!-- End .tab-content -->
                        </div><!-- End .form-tab -->
                    </div><!-- End .form-box -->
                </div><!-- End .modal-body -->
            </div><!-- End .modal-content -->
        </div><!-- End .modal-dialog -->
    </div><!-- End .modal -->

    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


    
    <script>



        // PRODUCT PLUSIING
        $(document).ready(function () {
            updateTotal()
        })
        function updateTotal() {
            let sum = 0;

            $("#myTable > tbody > tr").each(function () {
                let qty = parseFloat($(this).find(".qty").val());
                let price = parseFloat($(this).find(".price").text().replace("₹", ""));
                let amount = qty * price;
                sum += amount;
            });

            $(".subtotal .total").text("₹" + sum.toFixed(2));
        }

        $('.plus').on('click', function () {
            console.log('plus button clicked')

            let $quantityInput = $(this).siblings('.qty');

            let value = parseInt($quantityInput.val(), 10);
            value = isNaN(value) ? 0 : value;
            value++;
            $quantityInput.val(value)

            let id = $quantityInput.data('id')
            console.log(id)
            // Get the product price from the same row
            let productPrice = parseFloat($(this).closest('tr').find('.price-col').text().replace('₹', ''));
            console.log("productPrice " + productPrice)

            let newTotal = value * productPrice;
            $(this).closest('tr').find('.total-col').text('₹' + newTotal.toFixed(2));
            updateTotal()
            const data = {
                incQuantity: value,
                id: id,
                // $quantityInput.text():

            }
            console.log(data)
            $.ajax({
                url: `/cartIn`,
                method: 'put',
                data: data,
                success: function (response) {
                    console.log(response)
                    if (response.message == "increment") {

                        window.location.reload();

                    }
                }
            })
        })


        // decrement 

        $('.minus').on('click', function () {
            console.log("minus button is clicked")

            let $quantityInput = $(this).siblings('.qty');
            let value = parseInt($quantityInput.val(), 10)
            value = isNaN(value) ? 0 : value;
            if (value > 1) {
                value--;
                $quantityInput.val(value);
            }
            let id = $quantityInput.data('id');
            let productPrice = parseFloat($(this).closest('tr').find('.price-col').text().replace('₹', ''));
            console.log("productPrice " + productPrice)

            let newTotal = value * productPrice;
            $(this).closest('tr').find('.total-col').text('₹' + newTotal.toFixed(2));

            updateTotal()

            const data = {
                value: value,
                id: id
            }
            console.log(data)

            $.ajax({
                url: `/cartd`,
                method: 'put',
                data: data,
                success: function (response) {
                    console.log(response)
                    if (response.message == "decrement") {
                        $quantityInput.val(response.quantity)
                        // console.log("yes")
                        // window.location.reload()
                    }
                }
            })
        })
        $(".removebtn").on('click', function () {
            console.log("delete button clicked")
            let cartid = $(this).attr('data-cartid');
            let id = $(this).attr('data-id');

            console.log(cartid)
            console.log(id);

            $.ajax({
                url: `/cartdel`,
                method: "put",
                data: {
                    id: id,
                    cartid: cartid
                },
                success: function (response) {
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": true,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "200",
                        "hideDuration": "500",
                        "timeOut": "1000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }

                    if (response.message == "deleted") {
                        toastr.info("Product Removed Successfully", "Success")
                        location.reload();

                    }
                }
            })
        })

    </script>

</body>


<!-- molla/dashboard.html  22 Nov 2019 10:03:13 GMT -->

</html>